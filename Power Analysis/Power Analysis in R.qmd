---
title: "Power and Sample Sizes in R"
author: "Mathias Quinn"
date: "5/22/2021"
description: "This can be used as an introduction to power analysis concepts and implementations using R."
toc: true
toc-title: "Table of Contents"
highlight-style: pygments
format: 
  html:
    fig-width: 8
    fig-height: 4
    code-fold: true
    code-line-numbers: true
    linkcolor: "orange"
---

Sources:

-   [PPT - Sample Size Calculation with R](https://med.und.edu/daccota/_files/pdfs/berdc_resource_pdfs/sample_size_r_module.pdf "PowerPoint")

This is based on Dr. Mark Williamson's work.

```{r, results='hide', warning=FALSE}
library(pwr)
library(quarto)
```

## Purpose of Power Analysis

When designing experiments, a key question to keep in mind is:

`How many animals/subjects do I need for my experiment?`

To small of a sample size can under detect the effect of interest; too large of a sample size, and you be lead to wasting unnecessary resources.

::: {.callout-important collaps="true"}
## Goal

We want to have enough samples to reasonably detect an effect if it really is there without wasting limited resources on too many samples.
:::

Effect size

:   The magnitude of the effect under the alternative hypothesis

    The larger the effect, the easier it is to detect and thus requires fewer samples

Power

:   The probability of correctly rejecting the null hypothesis if it is false

    Power is equal to $1-\beta$ where $\beta$ is the probability of a Type II error (FN)

    Higher power allows for a better chance of detecting a true effect, if it exists

    A standard power is equal to $0.80$

Significance level ($\alpha$)

:   The probability of falsely rejecting the null hypothesis even though it is true

    The lower the significance level, the more likely you are to avoid a false positive and the more samples are needed

    A standard significance level is equal to $0.05$

## Effect Sizes

The effect size in a power analysis is dependent on the sample data at hand.

### How to estimate the effect size (Options)

1.  Use background information to get means and variation, then calculate the effect size directly
2.  Use background information from similar studies to get means and variation, then calculate the effect size directly
3.  With no prior information, make an estimated guess on the effect size expected

$$
Effect Size = \frac {\mu_{1} - \mu_{2}}{\sigma}
$$

## Table of Tests and Functions

| ID  | Name of Test               | In R?   | Package     | Function             |
|---------------|---------------|---------------|---------------|---------------|
| 1   | One Mean t-test            | Yes     | pwr         | pwr.t.test           |
| 2   | Two Means t-test           | Yes     | pwr         | pwr.t.test           |
| 3   | Paired t-test              | Yes     | pwr         | pwr.t.test           |
| 4   | One-way ANOVA              | Yes     | pwr         | pwr.anova.test       |
| 5   | Single proportion test     | Yes     | pwr         | pwr.p.test           |
| 6   | Two proportions test       | Yes     | pwr         | pwr.2p.test          |
| 7   | Chi-squared test           | Yes     | pwr         | pwr.chisq.test       |
| 8   | Simple Linear Regression   | Yes     | pwr         | pwr.f2.test          |
| 9   | Multiple Linear Regression | Yes     | pwr         | pwr.f2.test          |
| 10  | Correlation                | Yes     | pwr         | pwr.r.test           |
| 11  | One Mean Wilcoxon Test     | Yes\*   | pwr         | pwr.t.test + 15%     |
| 12  | Mann-Whitney Test          | Yes\*   | pwr         | pwr.t.test + 15%     |
| 13  | Paired Wilcoxon Test       | Yes\*   | pwr         | pwr.t.test + 15%     |
| 14  | Kruskal-Wallace Test       | Yes\*   | pwr         | pwr.anova.test + 15% |
| 15  | Repeated Measures ANOVA    | Yes     | WebPower    | wp.rmanova           |
| 16  | Multi-way ANOVA            | Yes     | WebPower    | wp.kanova            |
| 17  | Multi-way ANOVA            | Yes     | WebPower    | wp.kanova            |
| 18  | Logistic Regression        | Yes     | WebPower    | wp.logistic          |
| 19  | Poisson Regression         | Yes     | WebPower    | wp.poisson           |
| 20  | Multilevel Modelling: CRT  | Yes     | WebPower    | wp.crt2arm           |
| 21  | Multilevel Modelling: MRT  | Yes     | WebPower    | wp.mrt2arm           |
| 22  | GLMM                       | Yes\*\* | Simr & lme4 |                      |

: Table of Statistical Tests and R Functions

## Statistical Tests

The following sections will go through each of the above tests and describe how/when to use their corresponding functions.

### One Mean t-test

This tests if a sample mean is any different from a set value from a normally distributed variable.

``` r
pwr.t.test(d, sig.level, power, type = c("two.sample", "one.sample", "paird"), alternative = c("two.sided", "less", "greater"))
```

**Inputs:**

-   d = effect size

-   sig.level = significance level

-   power = power of the test

-   type = type of test

**Effect Size Formula:**

$$
D = \frac {\bar{x_{2}} - \bar{x_{1}}}{std}
$$

**Examples:**

Calculate the sample sizes for the following scenarios (set $\alpha = 0.05$ and power = $0.80$)

1.  You are interested in determining if the average income of college freshman is less than $20,000$. You collect some trial data and discover that the mean income was $14,500$ with a standard deviation of $6000$.

2.  You are interested in determining if the average sleep time change in a year for college freshman is different from zero. You collect the following data of sleep change (in hours).

    |       |       |      |     |      |       |      |      |     |      |     |
    |-------|-------|------|-----|------|-------|------|------|-----|------|-----|
    | Sleep | -0.55 | 0.16 | 2.6 | 0.65 | -0.23 | 0.21 | -4.3 | 2   | -1.7 | 1.9 |

    : Sleep Change

**Answers:**

1.  

```{r}
D1 = (14500 - 20000) / 6000
pwr.t.test(d = D1, sig.level = 0.05, power = 0.80
           , type = "one.sample", alternative = "less")
```

Rounding up gives us 9 people for our sample size, given the parameters above.

2\.

```{r}
dfSleep = data.frame(Change = c(-0.55, 0.16, 2.6, 0.65, -0.23, 0.21, -4.3, 2, -1.7, 1.9))

D2 = (mean(dfSleep$Change) - 0) / sd(dfSleep$Change)

pwr.t.test(d = D2, sig.level = 0.05, power = 0.80
           , type = "one.sample", alternative = "two.sided")
```

::: callout-warning
## Example 2 Problem

The second example in the power point is wrong, given the data presented.
:::

```{r}
library(quarto)
```
